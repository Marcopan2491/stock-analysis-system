# Agent Teams 团队规划文档

## 项目概述

**公司名称**: 一人AI开发公司  
**业务方向**: 智能股票行情分析系统  
**目标**: 构建多Agent协作团队，实现从数据采集到策略执行的全流程自动化开发

---

## 一、组织架构设计

### 1.1 核心团队架构

```
┌─────────────────────────────────────────────────────────┐
│                     Project Owner                        │
│                      (你 - 决策者)                        │
└─────────────────────────────────────────────────────────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│   数据采集    │  │   数据分析    │  │   策略开发    │
│    Agent     │  │    Agent     │  │    Agent     │
└──────────────┘  └──────────────┘  └──────────────┘
        │                  │                  │
        └──────────────────┼──────────────────┘
                           │
                           ▼
                  ┌────────────────┐
                  │   代码编写      │
                  │    Agent       │
                  └────────────────┘
                           │
                           ▼
                  ┌────────────────┐
                  │   扩展Agent    │
                  │  (按需创建)     │
                  └────────────────┘
```

### 1.2 Agent角色定义

| 角色 | Agent名称 | 核心职责 | 技术栈 | 优先级 |
|------|----------|---------|--------|--------|
| **数据采集Agent** | DataCollector | 股票数据采集、清洗、存储 | Python, Tushare/AKShare, Redis, PostgreSQL | P0 |
| **数据分析Agent** | DataAnalyst | 技术指标计算、数据可视化、报表生成 | Python, Pandas, NumPy, Matplotlib, Plotly | P0 |
| **策略开发Agent** | StrategyDev | 量化策略研发、回测、优化 | Python, vn.py, Backtrader, TA-Lib | P0 |
| **代码编写Agent** | CodeWriter | 前后端开发、API设计、系统集成 | Go, React/Vue, RESTful API, gRPC | P0 |
| **测试Agent** | Tester | 自动化测试、性能测试、代码审查 | Pytest, Go Test, Jest | P1 |
| **部署Agent** | DevOps | CI/CD、容器化、云服务管理 | Docker, K8s, GitHub Actions | P1 |

---

## 二、技术架构规划

### 2.1 系统整体架构

```
┌────────────────────────────────────────────────────────────┐
│                      前端层 (Frontend)                       │
├────────────────────────────────────────────────────────────┤
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐  │
│  │   Web端        │  │   移动端       │  │   管理后台     │  │
│  │   (React)     │  │   (React/Vue) │  │   (Vue)       │  │
│  └───────────────┘  └───────────────┘  └───────────────┘  │
└────────────────────────────────────────────────────────────┘
                           │
                           ▼ HTTP/REST/WebSocket
┌────────────────────────────────────────────────────────────┐
│                      网关层 (Gateway)                        │
├────────────────────────────────────────────────────────────┤
│  • API Gateway (Kong/Nginx)                                │
│  • 负载均衡                                                 │
│  • 限流熔断                                                 │
│  • 认证授权                                                 │
└────────────────────────────────────────────────────────────┘
                           │
                           ▼ gRPC/HTTP
┌────────────────────────────────────────────────────────────┐
│                      服务层 (Services)                       │
├────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  行情服务    │  │  策略服务    │  │      用户服务        │ │
│  │    (Go)     │  │    (Go)     │  │       (Go)          │ │
│  │             │  │             │  │                     │ │
│  │ • 实时行情   │  │ • 策略执行   │  │ • 用户管理          │ │
│  │ • 历史数据   │  │ • 信号生成   │  │ • 权限控制          │ │
│  │ • K线生成   │  │ • 回测引擎   │  │ • 账户管理          │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  回测服务    │  │  通知服务    │  │      报告服务        │ │
│  │   (Go)      │  │    (Go)     │  │       (Go)          │ │
│  │             │  │             │  │                     │ │
│  │ • 并行回测   │  │ • 微信通知   │  │ • 报告生成          │ │
│  │ • 绩效分析   │  │ • 邮件通知   │  │ • 数据导出          │ │
│  │ • 结果存储   │  │ • 飞书通知   │  │ • 图表渲染          │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌────────────────────────────────────────────────────────────┐
│                      引擎层 (Engine)                         │
├────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────────────────────┐ │
│  │                   量化交易引擎 (vn.py)                   │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌────────┐ │ │
│  │  │  CTP接口  │  │  策略模块  │  │  风控模块  │  │ 回测  │ │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └────────┘ │ │
│  └────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌────────────────────────────────────────────────────────────┐
│                      数据层 (Data)                           │
├────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  时序数据库   │  │  关系数据库   │  │      缓存层          │ │
│  │  (InfluxDB) │  │ (PostgreSQL)│  │      (Redis)        │ │
│  │             │  │             │  │                     │ │
│  │ • K线数据   │  │ • 用户数据   │  │ • 实时行情          │ │
│  │ • Tick数据  │  │ • 策略配置   │  │ • 会话数据          │ │
│  │ • 指标数据  │  │ • 交易记录   │  │ • 热点数据          │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│  ┌────────────────────────────────────────────────────────┐ │
│  │                   消息队列 (Kafka/RabbitMQ)              │ │
│  │              • 行情数据流 • 交易信号 • 系统事件          │ │
│  └────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

### 2.2 技术栈详细规划

#### 后端技术栈 (Go)

| 组件 | 技术选型 | 用途 |
|------|---------|------|
| Web框架 | Gin / Echo / Fiber | HTTP API服务 |
| RPC框架 | gRPC + Protobuf | 服务间通信 |
| 数据库ORM | GORM / Ent | 数据库操作 |
| 缓存 | go-redis | 缓存管理 |
| 消息队列 | kafka-go / amqp | 消息处理 |
| 配置管理 | Viper | 配置加载 |
| 日志 | Zap / Logrus | 结构化日志 |
| 监控 | Prometheus + Grafana | 系统监控 |

#### 策略与分析技术栈 (Python)

| 组件 | 技术选型 | 用途 |
|------|---------|------|
| 量化框架 | vn.py 3.x | 交易引擎核心 |
| 数据分析 | Pandas, NumPy | 数据处理分析 |
| 技术指标 | TA-Lib | 技术指标计算 |
| 可视化 | Matplotlib, Plotly | 图表生成 |
| 机器学习 | scikit-learn, XGBoost | 策略模型 |
| 回测 | Backtrader / vn.py CtaBacktester | 策略回测 |
| 数据源 | Tushare, AKShare, 通达信 | 股票数据 |

#### 前端技术栈

| 组件 | 技术选型 | 用途 |
|------|---------|------|
| Web端 | React 18 + TypeScript | 主站前端 |
| 移动端 | React Native / UniApp | 移动应用 |
| 管理后台 | Vue 3 + Element Plus | 后台管理 |
| 状态管理 | Zustand / Pinia | 状态管理 |
| UI组件 | Ant Design / Element Plus | UI组件库 |
| 图表 | ECharts / TradingView Chart | K线图、指标图 |
| 网络请求 | Axios / TanStack Query | HTTP/WebSocket |

---

## 三、Agent详细设计

### 3.1 数据采集Agent (DataCollector)

#### 职责范围
- 股票基础数据采集（股票列表、基本面数据）
- 实时行情数据订阅与存储
- 历史K线数据下载与维护
- 财务数据、公告数据采集
- 数据清洗与质量检查

#### 数据源对接
```yaml
数据源配置:
  实时行情:
    - Tushare Pro (付费)
    - AKShare (免费)
    - 新浪财经WebSocket
    - 东方财富接口
  
  历史数据:
    - Tushare
    - 通达信本地数据
    - 腾讯财经API
  
  基本面数据:
    - 股票基本信息
    - 财务报表
    - 股东信息
    - 龙虎榜数据
```

#### 核心任务清单
- [ ] 设计数据采集调度系统
- [ ] 实现多源数据适配器
- [ ] 构建数据清洗Pipeline
- [ ] 建立数据质量监控
- [ ] 设计增量更新机制

---

### 3.2 数据分析Agent (DataAnalyst)

#### 职责范围
- 技术指标计算与维护
- 多因子模型构建
- 行情数据统计分析
- 可视化报表生成
- 异常检测与预警

#### 技术指标库
```python
技术指标分类:
  趋势指标:
    - MA (移动平均线)
    - MACD (指数平滑异同平均线)
    - BOLL (布林带)
    - SAR (抛物线转向)
  
  震荡指标:
    - KDJ (随机指标)
    - RSI (相对强弱指标)
    - CCI (顺势指标)
    - WR (威廉指标)
  
  量能指标:
    - OBV (能量潮)
    - VOL (成交量)
    - DMI (趋向指标)
  
  自定义指标:
    - 自定义多因子
    - 机器学习特征
```

#### 核心任务清单
- [ ] 构建技术指标计算引擎
- [ ] 实现多因子评分模型
- [ ] 开发数据可视化组件
- [ ] 建立实时监控Dashboard
- [ ] 实现异常检测算法

---

### 3.3 策略开发Agent (StrategyDev)

#### 职责范围
- 量化策略研发与回测
- 策略参数优化
- 多策略组合管理
- 实盘交易信号生成
- 策略绩效分析

#### 策略分类
```yaml
策略类型:
  趋势跟踪:
    - 双均线策略
    - MACD趋势策略
    - 通道突破策略
    - 动量策略
  
  均值回复:
    - RSI超买超卖
    - 布林带回归
    - 统计套利
  
  多因子选股:
    - 价值因子
    - 成长因子
    - 质量因子
    - 动量因子
  
  机器学习策略:
    - 价格预测模型
    - 分类模型(涨跌预测)
    - 强化学习策略
```

#### vn.py集成方案
```python
策略开发框架:
  基础组件:
    - CtaTemplate: CTA策略模板
    - BacktestingEngine: 回测引擎
    - PortfolioManager: 组合管理
    - RiskManager: 风控管理
  
  扩展组件:
    - 自定义指标计算
    - 多策略信号聚合
    - 动态仓位管理
    - 止盈止损模块
```

#### 核心任务清单
- [ ] 搭建vn.py开发环境
- [ ] 开发基础策略模板
- [ ] 实现回测与绩效分析系统
- [ ] 建立策略参数优化流程
- [ ] 设计策略组合管理模块

---

### 3.4 代码编写Agent (CodeWriter)

#### 职责范围
- Go后端服务开发
- React/Vue前端开发
- API接口设计与实现
- 数据库设计与ORM
- 系统集成与联调

#### 项目结构
```
stock-analysis-system/
├── backend/                    # Go后端服务
│   ├── api-gateway/           # API网关
│   ├── services/              # 微服务
│   │   ├── market-service/   # 行情服务
│   │   ├── strategy-service/ # 策略服务
│   │   ├── user-service/     # 用户服务
│   │   ├── backtest-service/ # 回测服务
│   │   └── notify-service/   # 通知服务
│   ├── pkg/                   # 公共库
│   ├── proto/                 # Protocol Buffers
│   └── deploy/                # 部署配置
│
├── frontend/                  # 前端项目
│   ├── web/                  # Web端 (React)
│   ├── mobile/               # 移动端 (UniApp)
│   └── admin/                # 管理后台 (Vue)
│
├── strategy/                 # Python策略层
│   ├── vnpy_strategies/     # vn.py策略
│   ├── data_analysis/       # 数据分析
│   ├── backtest/            # 回测系统
│   └── utils/               # 工具函数
│
├── database/                 # 数据库
│   ├── migrations/          # 迁移脚本
│   └── scripts/             # 初始化脚本
│
└── deploy/                   # 部署
    ├── docker/              # Docker配置
    └── k8s/                 # Kubernetes配置
```

#### 核心任务清单
- [ ] 搭建项目脚手架
- [ ] 设计数据库Schema
- [ ] 实现API Gateway
- [ ] 开发核心业务服务
- [ ] 实现WebSocket实时推送

---

## 四、Agent协作工作流

### 4.1 标准开发流程

```
┌──────────────┐
│   需求输入    │ ◄── 你提出功能需求
└──────┬───────┘
       │
       ▼
┌─────────────────────────────────────────────────────┐
│  Phase 1: 需求分析与设计                              │
│  ┌─────────────┐    ┌─────────────┐                │
│  │ 数据分析师   │◄──►│ 策略开发师   │                │
│  │ 评估数据需求 │    │ 设计策略逻辑 │                │
│  └─────────────┘    └─────────────┘                │
└─────────────────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│  Phase 2: 数据采集与处理                              │
│  ┌─────────────┐                                    │
│  │ 数据采集员   │ ◄── 获取所需数据                     │
│  │ • 数据源配置 │                                    │
│  │ • 数据清洗   │                                    │
│  │ • 数据存储   │                                    │
│  └─────────────┘                                    │
└─────────────────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│  Phase 3: 策略开发与回测                              │
│  ┌─────────────┐    ┌─────────────┐                │
│  │ 策略开发师   │◄──►│ 数据分析师   │                │
│  │ • 策略编码   │    │ • 指标计算   │                │
│  │ • 回测验证   │    │ • 结果分析   │                │
│  │ • 参数优化   │    │ • 可视化     │                │
│  └─────────────┘    └─────────────┘                │
└─────────────────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│  Phase 4: 系统开发与集成                              │
│  ┌─────────────┐    ┌─────────────┐                │
│  │ 代码编写员   │◄──►│ 策略开发师   │                │
│  │ • 后端API   │    │ • 策略封装   │                │
│  │ • 前端界面   │    │ • 接口对接   │                │
│  │ • 系统集成   │    │ • 信号推送   │                │
│  └─────────────┘    └─────────────┘                │
└─────────────────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│  Phase 5: 测试与部署                                  │
│  ┌─────────────┐    ┌─────────────┐                │
│  │ 测试Agent   │    │ 部署Agent   │                │
│  │ • 功能测试   │    │ • CI/CD    │                │
│  │ • 性能测试   │───►│ • 容器化    │                │
│  │ • 集成测试   │    │ • 上线部署   │                │
│  └─────────────┘    └─────────────┘                │
└─────────────────────────────────────────────────────┘
                       │
                       ▼
┌──────────────┐
│   交付上线    │ ◄── 系统上线运行
└──────────────┘
```

### 4.2 飞书协作集成

#### 飞书机器人配置
```yaml
飞书机器人:
  名称: StockAgent-Bot
  功能:
    - 任务分配通知
    - 进度汇报
    - 异常告警
    - 日报/周报生成
  
  群组:
    - 开发进度群: 任务状态更新
    - 策略研究群: 策略信号通知
    - 运维告警群: 系统异常告警
```

#### 消息模板
```
【任务通知】
━━━━━━━━━━━━━━━━━━━━━
任务: {task_name}
负责: {agent_name}
截止: {deadline}
状态: {status}
━━━━━━━━━━━━━━━━━━━━━
详情: {task_details}

【策略信号】
━━━━━━━━━━━━━━━━━━━━━
策略: {strategy_name}
标的: {stock_code} {stock_name}
信号: {signal_type} (买入/卖出/持仓)
价格: {price}
时间: {timestamp}
说明: {signal_reason}
━━━━━━━━━━━━━━━━━━━━━

【系统告警】
━━━━━━━━━━━━━━━━━━━━━
级别: {alert_level}
服务: {service_name}
指标: {metric_name}
当前值: {current_value}
阈值: {threshold}
时间: {timestamp}
━━━━━━━━━━━━━━━━━━━━━
```

---

## 五、开发里程碑

### Phase 1: 基础设施 (第1-2周)
- [ ] 项目初始化与脚手架搭建
- [ ] 数据库设计与部署
- [ ] 飞书机器人接入
- [ ] Agent角色Prompt设计

### Phase 2: 数据层建设 (第3-4周)
- [ ] 数据采集Agent开发
- [ ] 多数据源对接(Tushare/AKShare)
- [ ] 历史数据初始化
- [ ] 数据质量监控系统

### Phase 3: 策略引擎 (第5-8周)
- [ ] vn.py环境搭建
- [ ] 基础策略模板开发
- [ ] 技术指标库建设
- [ ] 回测系统开发
- [ ] 策略优化工具

### Phase 4: 服务层开发 (第7-10周)
- [ ] API Gateway搭建
- [ ] 行情服务开发
- [ ] 策略服务开发
- [ ] 用户系统开发
- [ ] WebSocket实时推送

### Phase 5: 前端开发 (第9-12周)
- [ ] Web端行情界面
- [ ] K线图表组件
- [ ] 策略管理界面
- [ ] 回测结果展示
- [ ] 移动端基础版

### Phase 6: 集成与优化 (第11-14周)
- [ ] 系统集成测试
- [ ] 性能优化
- [ ] 监控告警完善
- [ ] 文档编写
- [ ] 生产环境部署

---

## 六、Agent Prompt 设计规范

### 6.1 数据采集Agent Prompt模板

```markdown
# 数据采集Agent - {AgentName}

## 角色定位
你是专业的金融数据采集工程师，专注于股票数据的自动化采集、清洗和存储。

## 核心能力
- 多源金融数据采集
- 数据清洗与验证
- 数据库优化设计
- 增量更新策略

## 技术栈
- Python 3.10+
- Tushare Pro / AKShare
- PostgreSQL / InfluxDB
- Redis / Kafka

## 工作规范
1. 所有数据采集必须包含异常处理
2. 数据存储前进行完整性校验
3. 关键操作记录日志
4. 提供采集状态报告

## 输出要求
- 代码文件 + 配置文件
- 数据字典文档
- 采集任务调度配置
- 监控告警规则
```

### 6.2 策略开发Agent Prompt模板

```markdown
# 策略开发Agent - {AgentName}

## 角色定位
你是量化交易策略研究员，专注于A股市场的技术分析和量化策略研发。

## 核心能力
- vn.py框架开发
- 技术指标策略
- 多因子选股模型
- 策略回测与优化

## 技术栈
- Python 3.10+
- vn.py 3.x
- Pandas / NumPy
- TA-Lib

## 策略开发规范
1. 所有策略继承CtaTemplate
2. 必须包含回测验证
3. 参数设置可配置化
4. 完善的风险控制
5. 详细的策略文档

## 输出要求
- 策略源代码(.py)
- 回测报告
- 参数配置说明
- 风险提示文档
```

### 6.3 代码编写Agent Prompt模板

```markdown
# 代码编写Agent - {AgentName}

## 角色定位
你是全栈开发工程师，专注于高性能金融系统的后端开发和前端实现。

## 核心能力
- Go微服务开发
- React/Vue前端开发
- 数据库设计与优化
- API设计与文档

## 技术栈
后端:
- Go 1.21+
- Gin / Echo
- GORM
- gRPC

前端:
- React 18 / Vue 3
- TypeScript
- ECharts / TradingView
- Ant Design / Element Plus

## 编码规范
1. 遵循Go/Python代码规范
2. 所有API必须包含Swagger文档
3. 单元测试覆盖率>70%
4. 关键路径添加日志

## 输出要求
- 源代码文件
- API接口文档
- 单元测试代码
- 部署配置
```

---

## 七、成本与资源规划

### 7.1 开发成本估算

| 项目 | 费用 | 说明 |
|------|------|------|
| Tushare Pro | ¥500-2000/年 | 高级数据权限 |
| 云服务器 | ¥300-800/月 | 2-4核8G配置 |
| 数据库服务 | ¥200-500/月 | RDS + Redis |
| AI模型调用 | ¥200-500/月 | 按量计费 |
| **月度合计** | **¥1200-3000** | - |

### 7.2 推荐云服务配置

```yaml
开发环境:
  服务器: 2核4G 2台
  数据库: PostgreSQL 4G + Redis 2G
  存储: 100GB SSD
  
生产环境:
  服务器: 4核8G 3台 (负载均衡)
  数据库: PostgreSQL 8G + Redis 4G
  存储: 500GB SSD
  带宽: 10Mbps
```

---

## 八、风险管理

### 8.1 技术风险

| 风险 | 影响 | 应对策略 |
|------|------|---------|
| 数据源不稳定 | 高 | 多数据源备份，本地缓存机制 |
| 策略实盘亏损 | 高 | 严格风控，小资金测试，及时止损 |
| 系统性能瓶颈 | 中 | 水平扩展，缓存优化，异步处理 |
| 数据安全风险 | 高 | 加密存储，访问控制，审计日志 |

### 8.2 合规风险

- **金融牌照**: 系统仅用于个人研究和学习，不涉及公开募资
- **数据使用**: 遵守各数据源使用协议
- **交易接入**: 如需实盘，确保券商API合规使用

---

## 九、附录

### 9.1 推荐学习资源

**量化交易:**
- 《vn.py项目文档》: https://www.vnpy.com/docs/
- 《Python量化交易实战》
- 《量化投资：策略与技术》

**Go开发:**
- 《Go语言高级编程》
- Gin框架官方文档
- Go微服务实践

**前端开发:**
- React官方文档
- ECharts股票图表案例
- TradingView Lightweight Charts

### 9.2 数据接口参考

| 数据源 | 网址 | 费用 | 覆盖范围 |
|--------|------|------|---------|
| Tushare | tushare.pro | 积分/付费 | A股全市场 |
| AKShare | akshare.akfamily.xyz | 免费 | A股全市场 |
| 聚宽 | joinquant.com | 免费/付费 | A股全市场 |
| 通达信 | - | 软件内置 | A股全市场 |

### 9.3 下一步行动

1. **立即行动**
   - [ ] 注册Tushare Pro账号
   - [ ] 准备云服务器
   - [ ] 安装vn.py开发环境
   - [ ] 创建飞书机器人

2. **本周目标**
   - [ ] 完成项目脚手架搭建
   - [ ] 设计数据库Schema
   - [ ] 编写Agent Prompt模板

3. **本月目标**
   - [ ] 数据采集Agent上线
   - [ ] 完成第一个策略回测
   - [ ] API服务基础框架完成

---

**文档版本**: v1.0  
**创建日期**: 2025年1月  
**维护者**: Agent Teams 规划系统  
**更新频率**: 每两周评审更新
