# Agent Teams 团队规划文档

## 项目概述

**公司名称**: 一人AI开发公司  
**业务方向**: 智能股票行情分析系统  
**目标**: 构建多Agent协作团队，实现从数据采集到策略执行的全流程自动化开发

---

## 一、组织架构设计

### 1.1 核心团队架构

```
┌─────────────────────────────────────────────────────────┐
│                     Project Owner                        │
│                      (你 - 决策者)                        │
└─────────────────────────────────────────────────────────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│   数据采集    │  │   数据分析    │  │   策略开发    │
│    Agent     │  │    Agent     │  │    Agent     │
└──────────────┘  └──────────────┘  └──────────────┘
        │                  │                  │
        └──────────────────┼──────────────────┘
                           │
                           ▼
                  ┌────────────────┐
                  │   代码编写      │
                  │    Agent       │
                  └────────────────┘
                           │
                           ▼
                  ┌────────────────┐
                  │   扩展Agent    │
                  │  (按需创建)     │
                  └────────────────┘
```

### 1.2 Agent角色定义

| 角色 | Agent名称 | 核心职责 | 技术栈 | 优先级 |
|------|----------|---------|--------|--------|
| **数据采集Agent** | DataCollector | 股票数据采集、清洗、存储 | Python, vn.py, MiniQMT, AKShare | P0 |
| **数据分析Agent** | DataAnalyst | 技术指标计算、数据可视化、报表生成 | Python, Pandas, NumPy, Matplotlib | P0 |
| **策略开发Agent** | StrategyDev | 量化策略研发、回测、优化 | Python, vn.py, Backtrader, TA-Lib | P0 |
| **代码编写Agent** | CodeWriter | 前后端开发、API设计、系统集成 | Go, React/Vue, RESTful API, gRPC | P0 |
| **测试Agent** | Tester | 自动化测试、性能测试、代码审查 | Pytest, Go Test, Jest | P1 |
| **部署Agent** | DevOps | CI/CD、容器化、云服务管理 | Docker, K8s, GitHub Actions | P1 |

---

## 二、数据源策略（重要更新）

### 2.1 数据源优先级（禁止付费数据源）

```yaml
数据源获取策略:
  第一优先级: vn.py 内置数据接口
    - RQData (免费额度)
    - 新浪财经接口
    - 腾讯财经接口
    - 东方财富接口
    优势:
      - 与vn.py框架无缝集成
      - 统一的API接口
      - 支持实时和历史数据
    
  第二优先级: MiniQMT (迅投)
    - 需要开通QMT权限的券商账户
    - 支持历史数据下载
    - 支持实时行情订阅
    优势:
      - 数据质量高
      - 速度快
      - 支持Tick级数据
    
  第三优先级: AKShare (免费开源)
    - 新浪财经
    - 东方财富
    - 腾讯财经
    - 同花顺
    优势:
      - 完全免费
      - 数据源多样
      - 社区活跃
    
  第四优先级: 爬虫方式
    - 同花顺网站
    - 东方财富网站
    - 新浪财经网站
    注意:
      - 需遵守网站robots.txt
      - 控制请求频率
      - 做好异常处理
```

### 2.2 沪深A股数据范围

| 数据类型 | 覆盖范围 | 更新频率 | 存储方式 |
|---------|---------|---------|---------|
| 股票列表 | 沪深A股全市场 | 每日 | PostgreSQL |
| 日K线数据 | 沪深A股全市场 | 每日盘后 | InfluxDB |
| 分钟K线 | 沪深A股全市场 | 实时/盘后 | InfluxDB |
| 实时行情 | 自选股列表 | 实时推送 | Redis |
| 财务数据 | 沪深A股全市场 | 季度 | PostgreSQL |

---

## 三、技术架构规划

### 3.1 系统整体架构

```
┌────────────────────────────────────────────────────────────┐
│                      前端层 (Frontend)                       │
├────────────────────────────────────────────────────────────┤
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐  │
│  │   Web端        │  │   移动端       │  │   管理后台     │  │
│  │   (React)     │  │   (React/Vue) │  │   (Vue)       │  │
│  └───────────────┘  └───────────────┘  └───────────────┘  │
└────────────────────────────────────────────────────────────┘
                           │
                           ▼ HTTP/REST/WebSocket
┌────────────────────────────────────────────────────────────┐
│                      网关层 (Gateway)                        │
├────────────────────────────────────────────────────────────┤
│  • API Gateway (Kong/Nginx)                                │
│  • 负载均衡                                                 │
│  • 限流熔断                                                 │
│  • 认证授权                                                 │
└────────────────────────────────────────────────────────────┘
                           │
                           ▼ gRPC/HTTP
┌────────────────────────────────────────────────────────────┐
│                      服务层 (Services)                       │
├────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  行情服务    │  │  策略服务    │  │      用户服务        │ │
│  │    (Go)     │  │    (Go)     │  │       (Go)          │ │
│  │             │  │             │  │                     │ │
│  │ • 实时行情   │  │ • 策略执行   │  │ • 用户管理          │ │
│  │ • 历史数据   │  │ • 信号生成   │  │ • 权限控制          │ │
│  │ • K线生成   │  │ • 回测引擎   │  │ • 账户管理          │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  回测服务    │  │  通知服务    │  │      报告服务        │ │
│  │   (Go)      │  │    (Go)     │  │       (Go)          │ │
│  │             │  │             │  │                     │ │
│  │ • 并行回测   │  │ • 微信通知   │  │ • 报告生成          │ │
│  │ • 绩效分析   │  │ • 邮件通知   │  │ • 数据导出          │ │
│  │ • 结果存储   │  │ • 飞书通知   │  │ • 图表渲染          │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌────────────────────────────────────────────────────────────┐
│                      引擎层 (Engine)                         │
├────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────────────────────┐ │
│  │                   量化交易引擎 (vn.py)                   │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌────────┐ │ │
│  │  │  数据接口  │  │  策略模块  │  │  风控模块  │  │ 回测  │ │ │
│  │  └──────────┘  └──────────┘  └──────────┘  └────────┘ │ │
│  └────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌────────────────────────────────────────────────────────────┐
│                      数据层 (Data)                           │
├────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  时序数据库   │  │  关系数据库   │  │      缓存层          │ │
│  │  (InfluxDB) │  │ (PostgreSQL)│  │      (Redis)        │ │
│  │             │  │             │  │                     │ │
│  │ • K线数据   │  │ • 用户数据   │  │ • 实时行情          │ │
│  │ • Tick数据  │  │ • 策略配置   │  │ • 会话数据          │ │
│  │ • 指标数据  │  │ • 交易记录   │  │ • 热点数据          │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

### 3.2 技术栈详细规划

#### 后端技术栈 (Go)

| 组件 | 技术选型 | 用途 |
|------|---------|------|
| Web框架 | Gin / Echo | HTTP API服务 |
| RPC框架 | gRPC + Protobuf | 服务间通信 |
| 数据库ORM | GORM | 数据库操作 |
| 缓存 | go-redis | 缓存管理 |
| 配置管理 | Viper | 配置加载 |
| 日志 | Zap | 结构化日志 |

#### 策略与分析技术栈 (Python)

| 组件 | 技术选型 | 用途 |
|------|---------|------|
| 量化框架 | vn.py 3.x | 交易引擎核心 |
| 数据源 | vn.py DataManager | 数据获取 |
| 备用源 | MiniQMT / AKShare | 备选数据 |
| 数据分析 | Pandas, NumPy | 数据处理 |
| 技术指标 | TA-Lib | 指标计算 |
| 回测 | vn.py CtaBacktester | 策略回测 |

---

## 四、Agent详细设计

### 4.1 数据采集Agent (DataCollector)

#### 职责范围
- 股票基础数据采集（沪深A股列表、基本面数据）
- 日K线/分钟K线数据下载与维护
- 实时行情数据订阅与存储
- 多数据源适配与管理
- 数据清洗与质量检查

#### 数据源适配器设计
```python
# 数据源优先级实现
data_source_priority = {
    1: "vnpy_builtin",      # vn.py内置接口
    2: "miniqmt",           # MiniQMT接口
    3: "akshare",           # AKShare接口
    4: "web_crawler"        # 网页爬虫
}

# 每种数据源的适配器需实现统一接口
class DataSourceAdapter:
    def connect(self): pass
    def get_daily_bars(self, symbol, start, end): pass
    def get_minute_bars(self, symbol, start, end, freq): pass
    def get_realtime_quote(self, symbols): pass
    def get_stock_list(self): pass
```

#### 核心任务清单
- [ ] 设计多数据源适配器框架
- [ ] 实现vn.py内置数据接口适配
- [ ] 实现MiniQMT接口适配（如有权限）
- [ ] 实现AKShare备用接口
- [ ] 数据质量校验机制
- [ ] 增量更新与断点续传

---

### 4.2 数据分析Agent (DataAnalyst)

#### 职责范围
- 技术指标计算与维护
- 多因子模型构建
- 行情数据统计分析
- 可视化报表生成
- 异常检测与预警

#### 核心任务清单
- [ ] 构建技术指标计算引擎
- [ ] 常用技术指标库（MA/MACD/KDJ/RSI/BOLL等）
- [ ] 多因子评分模型
- [ ] 数据可视化组件
- [ ] 监控Dashboard

---

### 4.3 策略开发Agent (StrategyDev)

#### 职责范围
- 量化策略研发与回测
- 策略参数优化
- 多策略组合管理
- 实盘交易信号生成
- 策略绩效分析

#### 策略分类
```yaml
策略类型:
  趋势跟踪:
    - 双均线策略
    - MACD趋势策略
    - 通道突破策略
  
  均值回复:
    - RSI超买超卖
    - 布林带回归
  
  多因子选股:
    - 价值因子
    - 成长因子
    - 动量因子
```

#### 核心任务清单
- [ ] 搭建vn.py开发环境
- [ ] 基础策略模板开发
- [ ] 回测与绩效分析系统
- [ ] 策略参数优化流程
- [ ] 策略组合管理模块

---

### 4.4 代码编写Agent (CodeWriter)

#### 职责范围
- Go后端服务开发
- React/Vue前端开发
- API接口设计与实现
- 数据库设计与ORM
- 系统集成与联调

#### 核心任务清单
- [ ] 项目脚手架搭建
- [ ] 数据库Schema设计
- [ ] API Gateway实现
- [ ] 核心业务服务开发
- [ ] WebSocket实时推送

---

## 五、Agent协作工作流

### 5.1 标准开发流程

```
Phase 1: 需求分析 → Phase 2: 数据采集 → Phase 3: 策略开发 → Phase 4: 系统开发 → Phase 5: 测试部署
```

### 5.2 飞书协作集成

#### 消息模板
```
【任务通知】
━━━━━━━━━━━━━━━━━━━━━
任务: {task_name}
负责: {agent_name}
状态: {status}
━━━━━━━━━━━━━━━━━━━━━

【策略信号】
━━━━━━━━━━━━━━━━━━━━━
策略: {strategy_name}
标的: {stock_code} {stock_name}
信号: {signal_type}
━━━━━━━━━━━━━━━━━━━━━
```

---

## 六、开发里程碑

### Phase 1: 基础设施 (第1-2周) ⭐ 当前阶段
- [ ] 项目初始化与脚手架搭建
- [ ] 数据库设计与部署
- [ ] Agent角色Prompt设计
- [ ] 飞书机器人接入

### Phase 2: 数据层建设 (第3-4周)
- [ ] 数据采集Agent开发
- [ ] 多数据源对接(vn.py/MiniQMT/AKShare)
- [ ] 历史数据初始化
- [ ] 数据质量监控系统

### Phase 3: 策略引擎 (第5-8周)
- [ ] vn.py环境搭建
- [ ] 基础策略模板开发
- [ ] 技术指标库建设
- [ ] 回测系统开发

### Phase 4: 服务层开发 (第7-10周)
- [ ] API Gateway搭建
- [ ] 行情服务开发
- [ ] 策略服务开发
- [ ] WebSocket实时推送

### Phase 5: 前端开发 (第9-12周)
- [ ] Web端行情界面
- [ ] K线图表组件
- [ ] 策略管理界面

### Phase 6: 集成与优化 (第11-14周)
- [ ] 系统集成测试
- [ ] 性能优化
- [ ] 生产环境部署

---

## 七、附录

### 7.1 免费数据源参考

| 数据源 | 类型 | 覆盖范围 | 说明 |
|--------|------|---------|------|
| vn.py内置 | 免费接口 | A股 | 新浪财经/腾讯/东方财富 |
| MiniQMT | 券商接口 | A股 | 需开通QMT权限 |
| AKShare | 开源 | A股 | 完全免费 |
| 同花顺网页 | 爬虫 | A股 | 需遵守robots.txt |

### 7.2 下一步行动

1. **立即行动**
   - [ ] 安装vn.py开发环境
   - [ ] 测试各数据源可用性
   - [ ] 准备云服务器
   - [ ] 创建飞书机器人

2. **本周目标**
   - [ ] 完成项目脚手架搭建
   - [ ] 设计数据库Schema
   - [ ] 编写Agent Prompt模板

---

**文档版本**: v1.1  
**更新日期**: 2025年1月  
**更新说明**: 更新数据源策略，禁止付费数据源，优先使用vn.py/MiniQMT/AKShare
